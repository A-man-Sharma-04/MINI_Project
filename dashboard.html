<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>CommunityHub Dashboard</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <link rel="stylesheet" href="style.css" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="dashboard.css"> <!-- Link to the new, simpler CSS -->
  <meta name="description" content="Manage community events, report issues, and stay connected with CommunityHub's interactive dashboard.">
</head>
<body>
  <!-- Header with navigation -->
  <header class="dashboard-header">
    <div class="header-left">
      <div class="logo">Community<span>Hub</span></div>

      <!-- Search Bar (Visible on all tabs) -->
      <div class="search-container">
        <input type="text" id="global-search" placeholder="Search..." />
        <button class="search-btn">üîç</button>
      </div>
    </div>

    <div class="header-right">
      <!-- Notifications -->
      <button class="header-icon-btn" id="notifications-btn">
        <span class="notification-badge">3</span>üîî
      </button>

      <!-- Profile Dropdown -->
      <div class="profile-dropdown">
        <button class="profile-btn" id="profile-trigger">
          <span id="user-initial">U</span>
        </button>
        <div class="dropdown-menu" id="profile-menu" style="display: none;">
          <div class="dropdown-header">
            <div class="user-info">
              <div class="user-initial-large" id="user-initial-large">U</div>
              <div>
                <div id="user-name-display">User Name</div>
                <div class="user-email" id="user-email-display">user@example.com</div>
              </div>
            </div>
          </div>
          <hr class="dropdown-divider">
          <a href="profile.html" class="dropdown-item">My Profile</a> <!-- Link to dedicated profile page -->
          <a href="./settings.html" class="dropdown-item">Settings</a>
          <a href="#" class="dropdown-item">Rewards</a>
          <hr class="dropdown-divider">
          <a href="#" class="dropdown-item logout-btn" onclick="logout()">Logout</a>
        </div>
      </div>
    </div>
  </header>

  <!-- Main Navigation Tabs -->
  <nav class="main-nav">
    <button class="nav-btn active" data-tab="home">üè† Home</button>
    <button class="nav-btn" data-tab="map">üó∫Ô∏è Map</button>
    <button class="nav-btn" data-tab="feed">üì∞ Feed</button>
    <button class="nav-btn" data-tab="trending">üî• Trending</button>
    <!-- Removed profile tab from main nav -->
  </nav>

  <!-- Tab Content Container -->
  <main class="tab-content-container">
    <!-- Home Tab -->
    <section id="home-tab" class="tab-content active">
      <div class="home-welcome">
        <h2>Welcome back, <span id="home-user-name">User</span>!</h2>
        <p>What would you like to do today?</p>
      </div>

      <div class="quick-actions">
        <button class="quick-action-btn" onclick="showForm()">
          <span class="action-icon">‚ûï</span>
          <span class="action-text">Add New</span>
        </button>
        <button class="quick-action-btn" onclick="goToMapTab()">
          <span class="action-icon">üìç</span>
          <span class="action-text">View Map</span>
        </button>
        <button class="quick-action-btn" onclick="goToFeedTab()">
          <span class="action-icon">üì∞</span>
          <span class="action-text">See Feed</span>
        </button>
        <button class="quick-action-btn" onclick="goToTrendingTab()">
          <span class="action-icon">üî•</span>
          <span class="action-text">Trending</span>
        </button>
      </div>

      <div class="home-recent-activity">
        <h3>Your Recent Activity</h3>
        <div id="recent-activity-list">
          <!-- Will be populated by JS -->
        </div>
      </div>
    </section>

    <!-- Map Tab -->
    <section id="map-tab" class="tab-content">
      <div class="map-filters">
        <div class="filter-group">
          <label>Type:</label>
          <select id="map-type-filter" onchange="filterMapItems()">
            <option value="all">All Types</option>
            <option value="event">Events</option>
            <option value="issue">Issues</option>
            <option value="notice">Notices</option>
            <option value="report">Reports</option>
          </select>
        </div>

        <div class="filter-group">
          <label>Status:</label>
          <select id="map-status-filter" onchange="filterMapItems()">
            <option value="all">All Status</option>
            <option value="active">Active</option>
            <option value="in_progress">In Progress</option>
            <option value="resolved">Resolved</option>
            <option value="closed">Closed</option>
          </select>
        </div>

        <div class="filter-group">
          <label>Severity:</label>
          <select id="map-severity-filter" onchange="filterMapItems()">
            <option value="all">All Severity</option>
            <option value="low">Low</option>
            <option value="medium">Medium</option>
            <option value="high">High</option>
            <option value="critical">Critical</option>
          </select>
        </div>
      </div>

      <div class="map-container">
        <div id="map"></div>
        <div class="map-controls">
          <button class="map-control-btn" onclick="centerMap()">üìç</button>
          <button class="map-control-btn" onclick="zoomIn()">+</button>
          <button class="map-control-btn" onclick="zoomOut()">-</button>
        </div>
      </div>

      <div class="map-legend">
        <span><span class="legend-dot event"></span> Event</span>
        <span><span class="legend-dot issue"></span> Issue</span>
        <span><span class="legend-dot notice"></span> Notice</span>
        <span><span class="legend-dot report"></span> Report</span>
      </div>

      <div id="map-list-panel" class="map-list-panel">
        <div class="map-list-empty">Hover or tap a pin to see nearby posts.</div>
      </div>
    </section>

    <!-- Feed Tab -->
    <section id="feed-tab" class="tab-content">
      <div class="feed-controls">
        <div class="segmented-control">
          <button class="segment-btn active" data-feed-view="for-you">For You</button>
          <button class="segment-btn" data-feed-view="following">Following</button>
        </div>
      </div>

      <div id="feed-content">
        <div id="feed-list">
          <!-- Will be populated by JS -->
        </div>
        <button id="feed-load-more" class="btn-load-more" style="display:none;" onclick="loadMoreFeed()">Load more</button>
      </div>
    </section>

    <!-- Trending Tab -->
    <section id="trending-tab" class="tab-content">
      <div class="trending-filters">
        <div class="filter-group">
          <label>Location:</label>
          <select id="trending-location-filter" onchange="loadTrendingItems()">
            <option value="global" selected>Global</option>
            <option value="local">Local</option>
            <option value="city">City</option>
            <option value="state">State</option>
            <option value="country">Country</option>
          </select>
        </div>

        <div class="filter-group">
          <label>Sort By:</label>
          <select id="trending-sort-filter" onchange="loadTrendingItems()">
            <option value="popular">Most Popular</option>
            <option value="recent">Most Recent</option>
            <option value="top">Top Rated</option>
          </select>
        </div>
      </div>

      <div class="trending-content">
        <div class="trending-list" id="trending-list">
          <!-- Will be populated by JS -->
        </div>
        <button id="trending-load-more" class="btn-load-more" style="display:none;" onclick="loadMoreTrending()">Load more</button>
      </div>
    </section>

  </main>

  <!-- Floating Action Button -->
  <button class="fab" onclick="showForm()">+</button>

  <!-- Add Item Modal -->
  <div id="form-modal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="closeForm()">&times;</span>
      <h3>Add New Item</h3>

      <div class="form-section">
        <label for="form-type">Type</label>
        <select id="form-type" onchange="toggleFormFields()">
          <option value="event">Event</option>
          <option value="issue">Issue</option>
          <option value="notice">Notice</option>
          <option value="report">Report</option>
        </select>
      </div>

      <div class="form-section">
        <label for="form-title">Title</label>
        <input type="text" id="form-title" placeholder="Enter title" required />
      </div>

      <div class="form-section">
        <label for="form-desc">Description</label>
        <textarea id="form-desc" placeholder="Describe the item..." required></textarea>
      </div>

      <div class="form-section">
        <label>Location</label>
        <div class="location-inputs">
          <input type="number" id="form-lat" placeholder="Latitude" step="any" />
          <input type="number" id="form-lng" placeholder="Longitude" step="any" />
          <button onclick="getCurrentLocation()">üìç Use Current Location</button>
        </div>
      </div>

      <div id="dynamic-fields"></div>

      <div class="form-section">
        <label for="form-severity">Severity</label>
        <select id="form-severity">
          <option value="low">Low</option>
          <option value="medium">Medium</option>
          <option value="high">High</option>
          <option value="critical">Critical</option>
        </select>
      </div>

      <div class="form-section">
        <label for="form-images">Upload Images/Videos</label>
        <input type="file" id="form-images" multiple accept="image/*,video/*" />
        <div id="image-preview"></div>
      </div>

      <button class="btn btn-primary full-width" onclick="saveNewItem()">Save Item</button>
    </div>
  </div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="dashboard.js"></script> <!-- Link to the new, simpler JS -->
</body>
</html>